#!/bin/zsh
# validate dotfiles & safely restart Zsh
# args: --
local zdotdir=$ZDOTDIR
{
  unset ZDOTDIR
  print 'Validating...'
  if zsh --interactive --multios --zle /dev/null >/dev/null; then
    print 'Restarting...'
    exec zsh
  else
    local -i ret=$?
    print -u2 'Restart failed. Please fix the error(s) above.'
    return ret
  fi
} always {
  ZDOTDIR=$zdotdir
}
