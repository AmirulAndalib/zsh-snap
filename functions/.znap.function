#!/bin/zsh
# create one or more lazy-loading functions
# args: <func name>... <init code>
zmodload -Fa zsh/parameter p:funcstack

.znap.function() {
  emulate -L zsh; setopt $_znap_opts

  local body=$@[-1]
  shift -p 1
  eval "$@ () {
    unfunction $@
    $body
    \$funcstack[1] "\$@"
  }"
}

.znap.function "$@"
